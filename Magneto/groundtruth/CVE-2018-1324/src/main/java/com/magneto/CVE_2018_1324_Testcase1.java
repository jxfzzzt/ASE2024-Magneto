package com.magneto;

import cn.hutool.core.io.FileUtil;
import org.apache.commons.compress.archivers.zip.ZipFile;
import org.junit.Test;
import java.io.File;
import java.io.FileNotFoundException;

import static org.junit.Assert.assertNull;

public class CVE_2018_1324_Testcase1 {

    @Test(timeout = 60000)
    public void testLoop() {
        Exception e = null;
        ZipFile zipFile = null;
        try {
            File file = FileUtil.file(System.getProperty("user.dir"), "src/main/resources/evil.zip");
            zipFile = new ZipFile(file);
        } catch (Exception ex) {
            e = ex;
        } finally {
            try {
                zipFile.close();
            } catch (Exception ignored) {
            }
        }
        validateThrow(e);
    }

    public void validateThrow(Throwable e) {
        if (e instanceof FileNotFoundException) {
            return;
        }

        assertNull(e);
    }
}
