package com.magneto;

import com.thoughtworks.xstream.XStream;
import org.junit.Test;
import static org.junit.Assert.assertEquals;
import static org.junit.Assert.fail;

public class CVE_2020_26217_Testcase1 {

    @Test(timeout = 60000)
    public void testCannotInjectConvertImageIOContainsFilter() {
        final String xml = "<string class='javax.imageio.spi.FilterIterator'>\n" + " <iter class='java.util.ArrayList$Itr'>\n" + "   <cursor>0</cursor>\n" + "   <lastRet>1</lastRet>\n" + "   <expectedModCount>1</expectedModCount>\n" + "   <outer-class>\n" + "     <com.thoughtworks.acceptance.SecurityVulnerabilityTest_-Exec/>\n" + "   </outer-class>\n" + " </iter>\n" + " <filter class='javax.imageio.ImageIO$ContainsFilter'>\n" + "   <method>\n" + "     <class>com.thoughtworks.acceptance.SecurityVulnerabilityTest$Exec</class>\n" + "     <name>exec</name>\n" + "     <parameter-types/>\n" + "   </method>\n" + "   <name>exec</name>\n" + " </filter>\n" + " <next/>\n" + "</string>";
        try {
            XStream xstream = new XStream();
            xstream.fromXML(xml);
            fail("the test fail");
        } catch (Exception e) {
            validateThrow(e);
        }
    }

    public void validateThrow(Throwable e) {
        assertEquals("com.thoughtworks.xstream.security.ForbiddenClassException", e.getClass().getName());
    }
}
