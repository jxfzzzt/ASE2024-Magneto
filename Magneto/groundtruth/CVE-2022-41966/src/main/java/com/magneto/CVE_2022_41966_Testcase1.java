package com.magneto;

import com.thoughtworks.xstream.XStream;
import com.thoughtworks.xstream.XStreamException;
import org.junit.Test;
import static org.junit.Assert.assertFalse;
import static org.junit.Assert.assertTrue;

public class CVE_2022_41966_Testcase1 {

    @Test
    public void testStackOverflowWithRecursiveHashSet() {
        final String xml = "<set>\n" + "  <set>\n" + "    <set>\n" + "      <set>\n" + "        <set>\n" + "          <set>\n" + "            <string>a</string>\n" + "          </set>\n" + "          <set>\n" + "            <string>b</string>\n" + "          </set>\n" + "        </set>\n" + "        <set>\n" + "          <string>c</string>\n" + "          <set reference=\"../../../set/set[2]\"/>\n" + "        </set>\n" + "      </set>\n" + "    </set>\n" + "  </set>\n" + "</set>";
        try {
            XStream xstream = new XStream();
            xstream.fromXML(xml);
        } catch (XStreamException e) {
            validateThrow(e);
        }
    }

    public void validateThrow(Throwable e) {
        assertFalse(e instanceof StackOverflowError);
    }
}
